<!DOCTYPE html>
<html>

<head>

<!-- MathJax -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- MathJax -->


<meta charset="utf-8" />
<title>Some experiences with ZFS</title>

<link rel="stylesheet" href="../../style.css" type="text/css" />



<meta name="date" content="Sat, 08 Sep 2012 23:42:24 -0300" />


</head>
<body>

<article class="page">

<section class="pageheader">
<header class="header">
<span>
<span class="parentlinks">

<a href="../../">Rogério Brito's Digital Junkyard</a>/

<a href="../">posts</a>/

</span>
<span class="title">
Some experiences with ZFS

</span>
</span>

</header>


<nav class="actions">
<ul>


<li><a href="../../recentchanges/">RecentChanges</a></li>








</ul>
</nav>






</section>


<aside class="sidebar">


<div><div class="calendar"><table class="month-calendar">
    <tr>
    <th class="month-calendar-arrow"><a href="../../archives/2013/05/" title="May">&larr;</a></th>
    <th class="month-calendar-head" colspan="5"><a href="../../archives/2013/06/" title="June">Jun 2013</a></th>
    <th class="month-calendar-arrow"><a href="../../archives/2013/07/" title="July">&rarr;</a></th>
    </tr>
    <tr>
        <th class="month-calendar-day-head Sunday" title="Sunday">S</th>
        <th class="month-calendar-day-head Monday" title="Monday">M</th>
        <th class="month-calendar-day-head Tuesday" title="Tuesday">T</th>
        <th class="month-calendar-day-head Wednesday" title="Wednesday">W</th>
        <th class="month-calendar-day-head Thursday" title="Thursday">T</th>
        <th class="month-calendar-day-head Friday" title="Friday">F</th>
        <th class="month-calendar-day-head Saturday" title="Saturday">S</th>
    </tr>
    <tr>
        <td class="month-calendar-day-noday Sunday">&nbsp;</td>
        <td class="month-calendar-day-noday Monday">&nbsp;</td>
        <td class="month-calendar-day-noday Tuesday">&nbsp;</td>
        <td class="month-calendar-day-noday Wednesday">&nbsp;</td>
        <td class="month-calendar-day-noday Thursday">&nbsp;</td>
        <td class="month-calendar-day-noday Friday">&nbsp;</td>
        <td class="month-calendar-day-nolink Saturday">1</td>
    </tr>
    <tr>
        <td class="month-calendar-day-nolink Sunday">2</td>
        <td class="month-calendar-day-nolink Monday">3</td>
        <td class="month-calendar-day-nolink Tuesday">4</td>
        <td class="month-calendar-day-nolink Wednesday">5</td>
        <td class="month-calendar-day-nolink Thursday">6</td>
        <td class="month-calendar-day-nolink Friday">7</td>
        <td class="month-calendar-day-nolink Saturday">8</td>
    </tr>
    <tr>
        <td class="month-calendar-day-nolink Sunday">9</td>
        <td class="month-calendar-day-nolink Monday">10</td>
        <td class="month-calendar-day-link Tuesday"><a href="../working_with_cvs_via_git/" title="working with cvs via git">11</a></td>
        <td class="month-calendar-day-nolink Wednesday">12</td>
        <td class="month-calendar-day-nolink Thursday">13</td>
        <td class="month-calendar-day-nolink Friday">14</td>
        <td class="month-calendar-day-nolink Saturday">15</td>
    </tr>
    <tr>
        <td class="month-calendar-day-nolink Sunday">16</td>
        <td class="month-calendar-day-nolink Monday">17</td>
        <td class="month-calendar-day-nolink Tuesday">18</td>
        <td class="month-calendar-day-nolink Wednesday">19</td>
        <td class="month-calendar-day-nolink Thursday">20</td>
        <td class="month-calendar-day-nolink Friday">21</td>
        <td class="month-calendar-day-nolink Saturday">22</td>
    </tr>
    <tr>
        <td class="month-calendar-day-nolink Sunday">23</td>
        <td class="month-calendar-day-nolink Monday">24</td>
        <td class="month-calendar-day-nolink Tuesday">25</td>
        <td class="month-calendar-day-nolink Wednesday">26</td>
        <td class="month-calendar-day-nolink Thursday">27</td>
        <td class="month-calendar-day-nolink Friday">28</td>
        <td class="month-calendar-day-this-day Saturday">29</td>
    </tr>
    <tr>
        <td class="month-calendar-day-future Sunday">30</td>
        <td class="month-calendar-day-noday Monday">&nbsp;</td>
        <td class="month-calendar-day-noday Tuesday">&nbsp;</td>
        <td class="month-calendar-day-noday Wednesday">&nbsp;</td>
        <td class="month-calendar-day-noday Thursday">&nbsp;</td>
        <td class="month-calendar-day-noday Friday">&nbsp;</td>
        <td class="month-calendar-day-noday Saturday">&nbsp;</td>
    </tr>
</table>
</div></div>


<p><a href="../../about/">About Me</a></p>

<iframe src="http://githubbadge.appspot.com/badge/rbrito" style="border: 0;height: 150px;width: 200px;overflow: hidden"></iframe>


<p><a href="../../archives/">Archives</a></p>

</aside>


<div id="pagebody">

<section id="content">
<p>Continuing the <a href="https://plus.google.com/117659222649141007981/posts/T3BcxA7wKjK">ZFS evaluation journey</a> (which I will summarize here with
the things that I learned), I was able to fit about 2.5TB of data on a
single 2TB drive, with deduplication enabled.</p>

<p>Unfortunately, even <em>moving</em> files around in ZFS (which you would think
would be a cheap operation) takes ages. Removing files also takes ages.</p>

<p>In a <em>completely</em> unloaded Phenom II X4 910 system running Linux 3.5.2
(actually, from Debian's experimental), and zfsonlinux version
0.6.0.71-0ubuntu1~precise1 (recompiled from source to work with my Debian
system), I tried to remove a subdirectory that had about 4000
files. According to time, it took:</p>

<pre><code>real    42m51.487s
user    0m0.188s
sys     0m16.769s
</code></pre>

<p>Which is a bit too slow.</p>

<p>I just (read: "yesterday") upgraded this machine from 4GB to 6GB of RAM
(well, I would have updated it to 8GB of RAM as that is what I ordered, but
it one of the RAM chips arrived dead here and I simply took one of the new
4GB card and one of the older 2GB card).</p>

<p>But, honestly, I don't see change in upgrading the RAM from 4GB to 6GB and,
unless something magic happens with 2GB more, I wouldn't expect a whole
different story with 8GB of RAM. Oh, no swap is being used (well, it is an
unloaded machine after all), and the Linux kernel swappiness knob is at its
default of 60.</p>

<p>What I <em>do</em> see, though, is that even for a single file removal, the disk is
thrashing a lot. I mean <em>like</em> crazy and that is, of course, the prime
suspect of the bad performance (of course, of course). So, there must be
some really crazy metadata churning going on here and I guess that the
people from the LLNL would like to know of their modules producing this
behavior.</p>

<p>Keep tuned for some future impressions.</p>

</section>





<div id="comments">

<div id="disqus_comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'digitaljunkyard'; // required: replace example with your forum shortname
    var discus_identifier = 'posts/some_experiences_with_zfs';
    var disqus_url = 'http://cynic.cc/blog//posts/some_experiences_with_zfs/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

</div>

</div>

</div>

<footer id="footer" class="pagefooter">

<nav id="pageinfo">




<nav class="tags">
Tags:

<a href="../../tags/compression/" rel="tag">compression</a>

<a href="../../tags/debian/" rel="tag">debian</a>

<a href="../../tags/debian-planet/" rel="tag">debian-planet</a>

<a href="../../tags/deduplication/" rel="tag">deduplication</a>

<a href="../../tags/filesystems/" rel="tag">filesystems</a>

<a href="../../tags/free-software/" rel="tag">free-software</a>

<a href="../../tags/linux/" rel="tag">linux</a>

<a href="../../tags/zfs/" rel="tag">zfs</a>

</nav>








<div class="pagedate">
Last edited <time datetime="2012-09-09T02:48:33Z">2012-09-08T23:48:33 BRT</time>
<!-- Created <time datetime="2012-09-09T02:42:24Z" pubdate="pubdate">2012-09-08T23:42:24 BRT</time> -->
</div>

</nav>


<!-- from Rogério Brito's Digital Junkyard -->
</footer>

</article>

</body>
</html>
